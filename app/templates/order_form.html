{% extends 'layout.html' %}
{% block head %}
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    body, input, select, textarea, button {
      font-family: 'Roboto', Arial, sans-serif;
    }
    .form-control, .form-select, textarea {
      border-radius: 0.7rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid #e0e0e0;
      transition: box-shadow 0.3s, border-color 0.3s;
      background: #fafbfc;
    }
    .form-control:focus, .form-select:focus, textarea:focus {
      border-color: #7abaff;
      box-shadow: 0 4px 16px rgba(122,186,255,0.18);
      background: #fff;
      outline: none;
      transition: box-shadow 0.3s, border-color 0.3s, background 0.3s;
    }
    .btn, button {
      border-radius: 0.7rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.1s;
      font-weight: 500;
    }
    .btn-success, .btn-primary {
      background: linear-gradient(90deg, #7abaff 0%, #4e9fff 100%);
      color: #fff;
      border: none;
    }
    .btn-success:hover, .btn-primary:hover {
      background: linear-gradient(90deg, #4e9fff 0%, #7abaff 100%);
      color: #fff;
      box-shadow: 0 4px 16px rgba(122,186,255,0.18);
      transform: translateY(-2px) scale(1.03);
    }
    .btn-secondary {
      background: #f3f6fa;
      color: #222;
      border: none;
    }
    .btn-secondary:hover {
      background: #e0e7ef;
      color: #222;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .form-label {
      font-weight: 500;
      color: #2a2a2a;
      letter-spacing: 0.01em;
    }
    h2 {
      font-family: 'Roboto', Arial, sans-serif;
      font-weight: 700;
      color: #2a2a2a;
      letter-spacing: 0.01em;
      margin-bottom: 1.5rem;
    }
    .form-control::placeholder {
      color: #b0b8c1;
      opacity: 1;
      font-size: 0.98em;
    }
    .form-select[multiple] option {
      transition: background 0.2s, color 0.2s;
    }
    .form-select[multiple]:focus option:checked {
      background: #7abaff;
      color: #fff;
      transition: background 0.2s, color 0.2s;
    }
    .fade-message {
      opacity: 0;
      transition: opacity 0.4s;
      pointer-events: none;
      position: absolute;
      left: 0; right: 0;
      margin: 0 auto;
      z-index: 1000;
      top: -2.5rem;
      width: max-content;
      min-width: 200px;
      text-align: center;
      border-radius: 0.7rem;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 0.7rem 1.2rem;
      font-size: 1.05em;
      color: #2a2a2a;
    }
    .fade-message.show {
      opacity: 1;
      pointer-events: auto;
    }
    .fade-message.error {
      background: #ffeaea;
      color: #c00;
      border: 1px solid #ffbdbd;
    }
    .fade-message.success {
      background: #eaffea;
      color: #1a7f3c;
      border: 1px solid #baffc1;
    }
    form.row.g-3 {
      position: relative;
    }
    body {
      background: #f7fafd;
      color: #222;
    }
  </style>
{% endblock %}
{% block content %}
<h2 class="mb-4">Нове замовлення</h2>
<div id="order-message" class="fade-message"></div>
<form method="post" class="row g-3" id="orderForm">
    <div class="col-md-4">
        <label class="form-label">Instagram</label>
        <input type="text" name="instagram" class="form-control" required>
    </div>
    <div class="col-md-4">
        <label class="form-label">Місто</label>
        <input type="text" name="city" class="form-control" required>
    </div>
    <div class="col-md-4">
        <label class="form-label">Вулиця</label>
        <input type="text" name="street" class="form-control" required>
    </div>
    <div class="col-md-2">
        <label class="form-label">Номер будинку</label>
        <input type="text" name="building_number" class="form-control" required>
    </div>
    <div class="col-md-2">
        <label class="form-label">КВ/поверх</label>
        <input type="text" name="floor" class="form-control">
    </div>
    <div class="col-md-2">
        <label class="form-label">Під'їзд</label>
        <input type="text" name="entrance" class="form-control">
    </div>
    <div class="col-md-3">
        <label class="form-label">Телефон</label>
        <input type="text" name="phone" class="form-control" required>
    </div>
    <div class="col-md-3">
        <label class="form-label">Тип доставки</label>
        <select name="type" class="form-select" required>
            <option value="">Оберіть тип доставки</option>
            <option value="Разова">Разова</option>
            <option value="Постійна">Постійна</option>
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Розмір</label>
        <input type="text" name="size" class="form-control">
    </div>
    <div class="col-md-3">
        <label class="form-label">Часове вікно</label>
        <input type="text" name="time_window" class="form-control">
    </div>
    <div class="col-md-4">
        <label class="form-label">Дні доставки</label>
        <select name="preferred_days" class="form-select" multiple required>
            <option value="пн">Пн</option>
            <option value="вт">Вт</option>
            <option value="ср">Ср</option>
            <option value="чт">Чт</option>
            <option value="пт">Пт</option>
            <option value="сб">Сб</option>
            <option value="нд">Нд</option>
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Кількість доставок</label>
        <input type="number" name="delivery_count" class="form-control" value="1" min="1" required>
    </div>
    <div class="col-md-3">
        <label class="form-label">Букет</label>
        <select name="bouquet_id" class="form-select" required>
            <option value="">Оберіть букет</option>
            {% for b in bouquets %}
                <option value="{{ b.id }}">{{ b.bouquet_size }} ({{ b.delivery_type }}) — {{ b.price }} грн</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label">Періодичність</label>
        <select name="periodicity" class="form-select">
            <option value="1/7">Щотижня</option>
            <option value="1/14">Раз на 2 тижні</option>
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label">Час з</label>
        <input type="time" name="time_from" class="form-control">
    </div>
    <div class="col-md-3">
        <label class="form-label">Час до</label>
        <input type="time" name="time_to" class="form-control">
    </div>
    <div class="col-md-3">
        <label class="form-label">Телефон отримувача</label>
        <input type="text" name="recipient_phone" class="form-control">
    </div>
    <div class="col-md-12">
        <label class="form-label">Коментар</label>
        <textarea name="comment" class="form-control"></textarea>
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-success">Створити</button>
        <a href="/orders" class="btn btn-secondary">Скасувати</a>
    </div>
</form>
{% endblock %}
{% block scripts %}
<script>
// Плавне з'явлення/зникнення повідомлень
function showOrderMessage(msg, type='success') {
  const el = document.getElementById('order-message');
  el.textContent = msg;
  el.className = 'fade-message ' + type + ' show';
  setTimeout(() => { el.classList.remove('show'); }, 2500);
}

// AJAX submit для форми замовлення
const orderForm = document.getElementById('orderForm');
if (orderForm) {
  orderForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(orderForm);
    const phone = orderForm.querySelector('[name="phone"]').value;
    const recipient = orderForm.querySelector('[name="recipient_phone"]');
    if (recipient && !recipient.value) {
      recipient.value = phone;
    }
    fetch('/orders/new', {
      method: 'POST',
      headers: {'X-Requested-With': 'XMLHttpRequest'},
      body: formData
    })
    .then(async r => {
      if (r.ok) {
        showOrderMessage('Замовлення створено!', 'success');
        setTimeout(() => window.location.href = '/orders', 1200);
      } else {
        const data = await r.json();
        showOrderMessage(data.error || 'Помилка!', 'error');
      }
    })
    .catch(() => showOrderMessage('Помилка зʼєднання!', 'error'));
  });
}

// Плавна анімація для вибору днів
const daysSelect = document.querySelector('select[name="preferred_days"]');
if (daysSelect) {
  daysSelect.addEventListener('change', function(e) {
    daysSelect.classList.add('changed');
    setTimeout(() => daysSelect.classList.remove('changed'), 400);
  });
}

// Плавна анімація для time_from/time_to
['time_from','time_to'].forEach(id => {
  const el = document.querySelector(`[name="${id}"]`);
  if (el) {
    el.addEventListener('change', function() {
      el.classList.add('changed');
      setTimeout(() => el.classList.remove('changed'), 400);
    });
  }
});
</script>
{% endblock %} 